<!DOCTYPE html>
<html lang="en">
<head>
	<include href="blocks/head.html" />
	<include href="blocks/taskboard-head.html" />
	<check if="{{ !empty(@taskboard[0]) }}">
		<style type="text/css">
		/*  */
		#taskboard table {
			min-width: {{ 252 * (count(@taskboard[0].columns) + 1) }}px;
		}

		/* Make large screens more useful */
		@media screen and (min-width: min-width: {{ 350 * (count(@taskboard[0].columns) + 1) }}px) {
			#taskboard, #taskboard .card {
				font-size: 14px;
			}
			#taskboard .column:not(.column-1) {
				width: 350px;
			}
			#taskboard .card.story .top {
				height: 20px;
				padding: 0;
			}
			#taskboard .card.story .owner {
				width: 135px;
			}
			#taskboard .card.task {
				width: 160px;
				height: 120px;
			}
			#taskboard .card .top {
				height: 20px;
			}
			#taskboard .card .title {
			    top: -4px;
			    height: 78px;
			}
			#taskboard .card .owner {
				height: 18px;
			}
			#taskboard .card .hours,
			#taskboard .card .priority {
				padding: 0px 7px;
				line-height: 18px;
				font-size: 16px;
			}
		}
		</style>
	</check>
</head>
<body>
	<include href="blocks/navbar.html" />
	<section id="taskboard">
		<table class="table taskboard-head">
			<tr class="tb-row">
				<th class="column column-1">
					<div class="btn-group">
						<button type="button" class="btn btn-default btn-xs dropdown-toggle" data-toggle="dropdown">
							Filter Tasks <span class="caret"></span>
						</button>
						<ul class="dropdown-menu" role="menu">
							<li class="{{ @filter == 'all' ? 'active' : '' }}"><a href="/taskboard/{{ @PARAMS.id }}/all">All Tasks</a></li>
							<li class="{{ @filter == 'groups' ? 'active' : '' }}"><a href="/taskboard/{{ @PARAMS.id }}/groups">My Groups</a></li>
							<li class="{{ @filter == 'me' ? 'active' : '' }}"><a href="/taskboard/{{ @PARAMS.id }}/me">My Tasks</a></li>
						</ul>
					</div>
				</th>
				<repeat group="{{ @statuses }}" key="{{ @key }}" value="{{ @value }}">
					<th class="column column-{{ @key + 2 }}">{{ @value.name }}</th>
				</repeat>
			</tr>
		</table>
		<table id="task-table" class="table">
			<repeat group="{{ @taskboard }}" value="{{ @row }}">
				<tr data-story-id="{{ @row.project.id }}" class="tb-row">
					<td class="column column-1">
						<div data-departement="I.T." class="card story" style="border-color:#{{ @row.project.owner_task_color }};">
							<div class="top">
								<i title="Add Task" class="add-task pull-right"></i>
								<span class="owner">
									<a href="/user/{{ @row.project.owner_username }}" target="_blank">{{ @row.project.owner_name }}</a>
								</span>
								<span class="task-id">
									<a href="/issues/{{ @row.project.id }}" target="_blank">{{ @row.project.id }}</a>
								</span>
							</div>
							<div class="title">{{ @row.project.name }}</div>
						</div>
					</td>
					<repeat group="{{ @row.columns }}" key="{{ @status_id }}" value="{{ @col }}">
						<td class="column column-{{ @status_id + 1 }} {{ @statuses[@status_id - 1]['closed'] ? 'completed' : '' }} droppable" data-status="{{ @status_id }}">
							<repeat group="{{ @col }}" value="{{ @task }}">
								<div data-departement="" class="card task" id="task_{{ @task.id }}" style="border-color:#{{ @task.owner_task_color }};">
									<div class="hours">{{ @task.hours_remaining ? @task.hours_remaining : '' }}</div>
									<div class="top">
										<span class="task-id"><a href="/issues/{{ @task.id }}" target="_blank">{{ @task.id }}</a></span>
									</div>
									<div class="title">{{ @task.name }}</div>
									<div class="description">{{ @task.description }}</div>
									<check if="{{ strtotime(@task.due_date) > 0 }}">
										<true>
											<div class="dueDate">{{ date('n/j/Y', strtotime(@task.due_date)) }}</div>
										</true>
										<false>
											<div class="dueDate"></div>
										</false>
									</check>
									<check if="{{ @task.priority == 0 }}">
										<true>
											<div class="priority normal">{{ @task.priority_name }}</div>
										</true>
										<false>
											<check if="{{ @task.priority < 0 }}">
												<true>
													<div class="priority low">{{ @task.priority_name }}</div>
												</true>
												<false>
													<div class="priority high">{{ @task.priority_name }}</div>
												</false>
											</check>
										</false>
									</check>
									<div class="owner">
										<a href="/user/{{ @task.owner_username }}" target="_blank">{{ @task.owner_name }}</a>
									</div>
								</div>
							</repeat>
						</td>
					</repeat>
				</tr>
			</repeat>
		</table>
		<div id="task-dialog" class="dialog" title="Edit Task" style="display: none;">
			<div class="row">
				<form id="task-dialog">
					<fieldset>
						<input type="hidden" name="taskId" id="taskId" value="">
						<div class="col-md-7">
							<label for="title">Title</label>
							<input type="text" name="title" id="title" class="form-control" />
							<label for="Description">Description</label>
							<textarea name="description" id="description" class="form-control"  rows="6"></textarea>
						</div>
						<div class="col-md-5">
							<label for="assigned">Assigned To</label>
							<select id="assigned" name="assigned" class="form-control" onchange="Taskboard.changeUser(this)">
								<option value="0" data-color="#AAAAAA">Not Assigned</option>
								<option value="{{ @user.id }}" data-color="#{{ @user.task_color }}" selected>{{ @user.name }}</option>
								<optgroup label="Groups">
									<repeat group="{{ @groups }}" value="{{ @group }}">
										<option value="{{ @group.id }}" data-color="#{{ @group.task_color }}">{{ @group.name }}</option>
									</repeat>
								</optgroup>
								<optgroup label="Users">
									<repeat group="{{ @users }}" value="{{ @user }}">
										<option value="{{ @user.id }}" data-color="#{{ @user.task_color }}" data-username="{{ @user.username }}">{{ @user.name }}</option>
									</repeat>
								</optgroup>
							</select>
							<label for="hours">Remaining (Hours)</label>
							<input type="textbox" name="hours" id="hours" class="form-control">
							<label for="password">Due Date</label>
							<input type="textbox" name="dueDate" id="dueDate" value="" class="dueDate form-control">
							<label for="priority">Priority</label>
							<select id="priority" name="priority" class="form-control" onchange="Taskboard.changeModalPriority($(this).find('option:selected').val())">
								<repeat group="{{ @priorities }}" value="{{ @priority }}">
									<option value="{{ @priority.value }}">{{ @priority.name }}</option>
								</repeat>
							</select>
						</div>
					</fieldset>
				</form>
			</div>
		</div>
	</section>
	<div data-departement="" class="card task cloneable" id="new_task">
		<div class="hours"></div><div class="top">
			<span class="task-id"></span>
		</div>
		<div class="title"></div>
		<div class="description"></div>
		<div class="dueDate"></div>
		<div class="priority normal">Normal Priority</div><div class="owner"></div>
	</div>
	<div class="container-fluid">
		<include href="blocks/footer.html" />
	</div>
	<script src="/minify/js/jquery-ui-1.10.3.min.js,jquery.ui.touch-punch.min.js"></script>
	<script src="/minify/js/taskboard.js"></script>
</body>
</html>